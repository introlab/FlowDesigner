dnl Process this file with autoconf to produce a configure script. -*-m4-*-

AC_INIT(data-flow/include/Node.h)

FREESPEECH_MAJOR_VERSION=0
FREESPEECH_MINOR_VERSION=4
FREESPEECH_MICRO_VERSION=1
FREESPEECH_VERSION=$FREESPEECH_MAJOR_VERSION.$FREESPEECH_MINOR_VERSION.$FREESPEECH_MICRO_VERSION
FREESPEECH_INTERFACE_AGE=0
FREESPEECH_BINARY_AGE=0


AC_SUBST(FREESPEECH_MAJOR_VERSION)
AC_SUBST(FREESPEECH_MINOR_VERSION)
AC_SUBST(FREESPEECH_MICRO_VERSION)
AC_SUBST(FREESPEECH_INTERFACE_AGE)
AC_SUBST(FREESPEECH_BINARY_AGE)
AC_SUBST(FREESPEECH_VERSION)

# libtool versioning
LT_RELEASE=$FREESPEECH_MAJOR_VERSION.$FREESPEECH_MINOR_VERSION
LT_CURRENT=`expr $FREESPEECH_MICRO_VERSION - $FREESPEECH_INTERFACE_AGE`
LT_REVISION=$FREESPEECH_INTERFACE_AGE
LT_AGE=`expr $FREESPEECH_BINARY_AGE - $FREESPEECH_INTERFACE_AGE`
AC_SUBST(LT_RELEASE)
AC_SUBST(LT_CURRENT)
AC_SUBST(LT_REVISION)
AC_SUBST(LT_AGE)

# For automake.
VERSION=$FREESPEECH_VERSION
PACKAGE=Overflow

AM_INIT_AUTOMAKE($PACKAGE, $VERSION, no-define)
AM_MAINTAINER_MODE


AC_CONFIG_SUBDIRS(vflow)

AC_MODULE_OPT(visix)
if test "$visix" = visix; then
AC_CONFIG_SUBDIRS(visix)
fi

AC_MODULE_OPT(audio_blocks)
if test "$audio_blocks" = audio_blocks; then
AC_CONFIG_SUBDIRS(audio_blocks)
fi

AC_MODULE_OPT(effects)
if test "$effects" = effects; then
AC_CONFIG_SUBDIRS(effects)
fi

AC_MODULE_OPT(NNet)
if test "$NNet" = NNet; then
AC_CONFIG_SUBDIRS(NNet)
fi

AC_MODULE_OPT(HMM)
if test "$HMM" = HMM; then
AC_CONFIG_SUBDIRS(HMM)
fi

AC_MODULE_OPT(VQ)
if test "$VQ" = VQ; then
AC_CONFIG_SUBDIRS(VQ)
fi

AC_MODULE_OPT(video_blocks)
if test "$video_blocks" = video_blocks; then
AC_CONFIG_SUBDIRS(video_blocks)
fi

AC_MODULE_OPT(FuzzyEngine)
if test "$FuzzyEngine" = FuzzyEngine; then
AC_CONFIG_SUBDIRS(FuzzyEngine)
fi

modules="$audio_blocks $VQ $HMM $NNet $video_blocks $visix $FuzzyEngine $effects"
AC_SUBST(modules)

dnl Put configuration information in config.h.
#AM_CONFIG_HEADER(config.h)

AC_CANONICAL_HOST

AM_PROG_LIBTOOL

case "$host_os" in 
hpux*) OS=HPUX ;;
dnl mv libtool libtool-bak  
dnl cat libtool-bak | perl -ne 's/\+h /\\\${wl}\+h/; s/ \+b / \\\${wl}\+b/; s/\"\/.*\/ld\"/\"$CXX\"/; print' > libtool;;
linux*) OS=LINUX ;;
freebsd*) OS=FREEBSD ;;
solaris*) OS=SOLARIS ;;
esac
AC_DEFINE_UNQUOTED(${OS})
dnl Initialize libtool.

dnl AC_LIBTOOL_ACC_KLUDGE
AC_LIBTOOL_KLUDGE

#AM_SANITY_CHECK

dnl Checks for programs.

AM_C_PROTOTYPES
AC_PROG_CXX
AC_LANG_CPLUSPLUS
AC_PROG_MAKE_SET
dnl AC_PROG_RANLIB

dnl Checks for libraries.
AC_CHECK_HEADERS(semaphore.h)
AC_HASH_MAP
AC_CHECK_HEADER(sstream, rm -f $srcdir/data-flow/include/sstream, cp -f $srcdir/data-flow/include/sstream.unused $srcdir/data-flow/include/sstream)
dnl Test for math library, and define LIBS
AC_CHECK_LIB(m, sin)
AC_CHECK_LIB(dl, dlopen)
dnl AC_CHECK_LIB(pthread, pthread_create)
AC_THREAD

GNOME_XML_LIB=`gnome-config --libs xml`
GNOME_XML_INCLUDE=`gnome-config --cflags xml`
AC_SUBST(GNOME_XML_LIB)
AC_SUBST(GNOME_XML_INCLUDE)

AC_PATH_FFTW

dnl Checks for library functions.
AC_CHECK_FUNCS(pthread_cancel)

AC_DEFINE_UNQUOTED(INSTALL_PREFIX, "${prefix}")
AC_DEFINE_UNQUOTED(TOOLBOX_PATH, "${prefix}/toolbox")

dnl Output the makefiles and version.h.

AC_OUTPUT([Makefile \
	data-flow/Makefile \
	data-flow/src/Makefile data-flow/include/Makefile \
	data-flow/doc/Makefile data-flow/doc/html/Makefile \
	data-flow/doc/html/images/Makefile data-flow/n-files/Makefile \
	tools/Makefile tools/src/Makefile tools/m/Makefile examples/Makefile \
	])

