dnl Process this file with autoconf to produce a configure script.
CFLAGS="-O2"
CXXFLAGS="-O2"

AC_INIT([FDOpenCV], [0.0.1], [flowdesigner-devel@lists.sourceforge.net])


AC_PREREQ(2.53)

FDOPENCV_MAJOR_VERSION=0
FDOPENCV_MINOR_VERSION=0
FDOPENCV_MICRO_VERSION=1
FDOPENCV_VERSION=$FDOPENCV_MAJOR_VERSION.$FDOPENCV_MINOR_VERSION.$FDOPENCV_MICRO_VERSION
FDOPENCV_INTERFACE_AGE=0
FDOPENCV_BINARY_AGE=0


AC_SUBST(FDOPENCV_MAJOR_VERSION)
AC_SUBST(FDOPENCV_MINOR_VERSION)
AC_SUBST(FDOPENCV_MICRO_VERSION)
AC_SUBST(FDOPENCV_INTERFACE_AGE)
AC_SUBST(FDOPENCV_BINARY_AGE)
AC_SUBST(FDOPENCV_VERSION)

# libtool versioning
LT_RELEASE=$FDOPENCV_MAJOR_VERSION.$FDOPENCV_MINOR_VERSION
LT_CURRENT=`expr $FDOPENCV_MICRO_VERSION - $FDOPENCV_INTERFACE_AGE`
LT_REVISION=$FDOPENCV_INTERFACE_AGE
LT_AGE=`expr $FDOPENCV_BINARY_AGE - $FDOPENCV_INTERFACE_AGE`
AC_SUBST(LT_RELEASE)
AC_SUBST(LT_CURRENT)
AC_SUBST(LT_REVISION)
AC_SUBST(LT_AGE)

VERSION=$FDOPENCV_VERSION
PACKAGE=FDOpenCV


dnl Checks for programs.
AC_PROG_CXX
AC_PROG_AWK
AC_PROG_CC
AC_PROG_CPP
AC_PROG_INSTALL
AC_PROG_LN_S
AC_PROG_MAKE_SET
PKG_PROG_PKG_CONFIG
AC_CANONICAL_HOST
AC_DISABLE_STATIC
AC_ENABLE_SHARED
AM_PROG_LIBTOOL
AC_LANG_CPLUSPLUS

AC_ARG_PROGRAM

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_C_INLINE
AC_TYPE_SIZE_T

dnl Checks for library functions.
AC_FUNC_ALLOCA
AC_FUNC_MMAP
AC_CHECK_FUNCS(getcwd getwd putenv strdup)

dnl overflow-config test (Yannick Brosseau & Dominic Letourneau)

AC_PATH_PROG(AWK_PROG,awk,no,$PATH:$prefix/bin)
if test "$AWK_PROG" = no; then
	AC_MSG_ERROR(awk is required to configure $PACKAGE properly, please install it and try again.)
	exit
fi	


AC_PATH_PROG(FLOWDESIGNER_CONFIG,flowdesigner-config,no,$PATH:$FLOWDESIGNER_HOME/bin:$prefix/bin)
if test "$FLOWDESIGNER_CONFIG" = no; then
	AC_MSG_ERROR( Cannot find flowdesigner-config )
fi


AC_PATH_PROG(PKG_CONFIG,pkg-config,no,$PATH)
if test "$PKG_CONFIG" = no; then
	AC_MSG_ERROR( Cannot find pkg-config)
	exit
fi


VERSION=$FDOPENCV_VERSION
AM_INIT_AUTOMAKE($PACKAGE, $VERSION, no-define)
AM_MAINTAINER_MODE
 
dnl Additional includes & libraries

FLOWDESIGNER_LIB=`$FLOWDESIGNER_CONFIG --libs libflow audio_blocks`
FLOWDESIGNER_INCLUDE=`$FLOWDESIGNER_CONFIG --cflags config libflow audio_blocks`
FLOWDESIGNER_DATA=`$FLOWDESIGNER_CONFIG  --datadir`
FLOWDESIGNER_BIN=`$FLOWDESIGNER_CONFIG --bindir`
FLOWDESIGNER_PREFIX=`$FLOWDESIGNER_CONFIG --prefix`

dnl OpenCV includes & libraries
dnl detection of OpenCV image library
PKG_CHECK_MODULES(OPENCV, opencv >= 1.0.0,[OPENCV_FOUND="yes"],[OPENCV_FOUND="no"])

if test "$OPENCV_FOUND" = "yes"; then
	AC_MSG_RESULT([Using OpenCV lib : $OPENCV_LIBS])
	AC_MSG_RESULT([Using OpenCV cflags : $OPENCV_CFLAGS])
else
	AC_MSG_ERROR([OpenCV >= 1.0.0 not found, disabled])	
fi

AC_SUBST(OPENCV_CFLAGS)
AC_SUBST(OPENCV_LIBS)

PKG_CHECK_MODULES(GDK, gdk-2.0 >= 2.0.0,[GDK_FOUND="yes"],[GDK_FOUND="no"])
AC_SUBST(GDK_CFLAGS)
AC_SUBST(GDK_LIBS)


dnl Look for prefix, if not specified, use FlowDesigner default toolbox prefix
if test "x$prefix" = "xNONE"; then
    prefix=$FLOWDESIGNER_PREFIX                    
fi


AC_SUBST(FLOWDESIGNER_LIB)
AC_SUBST(FLOWDESIGNER_INCLUDE)
AC_SUBST(FLOWDESIGNER_DATA)
AC_SUBST(FLOWDESIGNER_BIN)


dnl Output Files (makefiles)
AC_OUTPUT(Makefile examples/Makefile)


dnl Notification message for the user to know which flags will be used for compilation
dnl should use AC_MSG_NOTICE(), but that's apparently not defined in autoconf 2.13
AC_MSG_RESULT([])
AC_MSG_RESULT([*************************************************************])
AC_MSG_RESULT([])
AC_MSG_RESULT([$PACKAGE will be built on a $build system to run])
AC_MSG_RESULT([on a $host system, with the following options:])
AC_MSG_RESULT([])

AC_MSG_RESULT([$PACKAGE will be installed in : $prefix])

